=======================================
############## AWS RDS ################ v4
> It is fully managed relational DB engine service where AWS is responsible for below:
- Security and patching of the DB instances
- Automatic backup for DB instance (defaults setting)
- Software update for the DB engine
- Easy scaling for storage and compute as required
- If selected multiple-AZ with synchronous replication between the active and standby DB instance
- Automatic failover if multiple-AZ options was selected
- Providing the ability to create DB read replicas for DB read scaling( intensive free deployment)

> Every DB instance has a weekly maintenance window 
- if you do not specify one at the time you created the DB instance 
- it will choose one randomly for you that is 30 minute long
=======================================
## AWS is not responsible for
- Managing DB setting 
- building a relational DB schema 
- DB performance tuning

## Supported relational DB engine
- MS SQL server, 
- Oracle 
- postgreSQL 
- mariaBD, 
- aws Aurora, 
- mysql

## 2 Licensing model
1. Bring your own licence
2. Licence included

##RDS LIMITS
> Up to 40 DB instances per account
- 10 of this 40 can be Oracle or MS SQL server under licence included model

> Under BYOL model, all 40 can be any DB engine you need 

##RDS instance storage
> Amazon RDS use EBS volume not instance store for DB and logs storage

> General purpose storage used for DB works with moderate I/O requirements
> Provision IOPS RDS storage use for high performance OLTP workload
> Magnetic RDS storage used for small DB workloads

##Maximum storage capacity for RDS DB instances
> Upto 4tb for my SQL server
> upto 6TB for the the rest of supported RDS DB engines
=======================================
######### MULTI-AZ RDS OPTION #########

> You can select the multi-AZ option during RDS DB instance launch

> RDS service CREATE A STANDBY INSTANCE IN A DIFFERENT AZ IN THE SAME REGION and configure SYNCHRONOUS replication between the primary and standby

> we/app cannot read and write to the standby RDS DB instance

> you cannot dictate/select which AZ in the region will be chosen to create the standby DB instance 
- we can view which AZ is selected after the standby is created

## Multi-AZ RDS option

> depending on the instance class it may take 1 to few minutes to failover to the standby instance 
- It is recommended to implement DB connection retries into your applications, 
- App may take few minute to switch to standb in case of failure.

> AWS recommendation to use provisioned IOPS instances for multi-AZ RDS instances

##### FAILOVER TRIGGER ######

> Failover may be triggered when
- Loss of primary AZ or primary DB instance failure
- Loss of network connectivity to primary
- Compute(EC2) unit failure on primary
- Storage(EBS) unit failure on primary
- Primary DB instance is changed
- Patching the OS of the DB instance

- Manual failover(reboot with failover on primary)

## MULTI-AZ FAILOVER LOGISTICS

> during failover the CNAME of the RDS DB instance is updated to map to the standby IP address 
- this is why it is recommended to use endpoint to reference your DB instance and not its IP addresses

> CNAME does not change because the RDS endpoint is not changed

> RDS endpoints does not change by selecting multi-AZ option
-  however the primary and standby instance will have different IP address given they are in different AZs
- Hence it is always recommended that do not use the IP address to point to your multi-AZ RDS instance rather use the endpoint

> This is very helpful in a failover scenario the primary will fail to the standby i.e. IP address of RDS instance will change
- Referencing by endpoint means there is no change(endpoint wise) when a failover happened, so no disruptions or manual intervention to facilitate RDS DB instance access in a failover scenario

## MULTI-AZ RDS Manual failover and reboot
> In multi-AZ deployment, you can only initiate a manual RDS DB instance failover(primary to secondary) when rebooting
- This is by selecting the "reboot with failover" reboot option on the primary RDS DB instance

> A DB instance reboot is required for changes to take effect when you change the DB parameter group or when you change a static DB parameter

- This reboot restart the DB engine
> The DB parameter group is a configuration container for the DB engine configuration

###### Multi-AZ RDS event notifications
> You will be alerted by a DB instance event when a failover occurs

> AWS RDS uses AWS SNS to send RDS event via SNS notification
- You can use API calls to the RDS service to list the RDS events in the past 14 days(DescribeEvents API)
- You can view past 14 days events using CLI
- Using AWS console, you can only view RDS event for the last one day i.e 24 hour

## PROCESS THAT HAPPENED ON THE STANDBY FIRST
> The following procedure are done on the standby first then on primary
- OS patching
- system upgrades 
- DB scaling

> in multi-AZ snapshot and automatic backup are done on the standby instance to avoid I/O suspension on primary instance

## Multi-AZ deployment maintenance
> The sequence is as follow m
- aintenance on standby is performed 
- standby promoted to primary 
- maintain is performed on old primary (current standby)

## Version upgrade
> You can manually upgrade DB instance to a supported DB engine version from AWS console as follows

RDS -> DB instance -> modify DB instance -> set DB engine version

> By default, change will take effect during the next maintenance window
> You can force an immediate upgrade if you need to

> In multi-AZ deployments:
- Version upgrade will be conducted on both primary and standby at the same time, which will cause an outage (unavailability of both)
> Advised to do during change/maintenance window

## Security group and NaCl
> In a multi-AZ scenario make sure that your security group and NACL will allow your app server to communicate with both primary and standby instance 
- in case of a failure failover the standby become the primary
=======================================
##### DB AUTOMATIC BACKUP OR MANUAL SNAPSHOT 
> These are the two method to backup and restore your RDS DB instances
1. AWS RDS automatic backups
2. user intiated manual backup

> either one backup up the entire DB instance and not just the individual DB
> either one create a storage volume snapshot of your entire DB instance not just the individual database
> You can make copies of automatic backup and of manual snapshot

## DB automated backups
>  Automated backup by AWS, back up your DB data to multiple AZs to provide for data durability
> Are labelled automated in AWS console (easily distinguishable)
> Stored in Amazon S3
> Multi-AZ automatic backup will be taken from the standby instance not the primary
> The DB instance must be in "active" state for the automatic backup to happen 
- if in any other state like "storage_full" state the automatic backup will not happen

## DB automated backup
> Automatic backup (not the manual one) are used for point-in-time DB instance recovery

> It can restore the DB up to 5 minutes in time, using the DB transaction logs and the automated snapshot

> RDS automatically backup the DB instance daily, by creating a storage volume snapshot of your DB instance (full daily snapshot), including the DB transaction logs(modifications) which are critical to be able to restore upto last 5 minutes in time
- You can choose when during the day this is done (backup window)

> No additional charge for RDS backing up your DB instance
> Enabled by default, you can disable it by setting retention period to 0

> During your daily backup window, your I/O may be suspended (for standalone RDS deployment)
> For multi-AZ deployment, backup are taken from the standby DB instance (true for MariaDB, mySQL, Oracle, PostgreSQL)

> Automatic backup deleted when you delete your RDS DB instance
> An outage occur if you change the backup retention period from zero to non zero value or the other way around

> Automatic backup are currently supported only for InnoDB storage engine for MySQL (and not for myISAM engine)
> Use to automatic backup with other MySQL DB storage engines including ISAM, may lead to unpredictable behaviour during restoration

## DB retention period
> The period of time AWS keep the automatic backup before deleting them
> by default : 
- 7 days is configured from the AWS console for all DB engine (except Arora default is one day regardless how it was configured)

> 1 day is configured from API or CLI (for all DB engine including Arora)
> You can increase it up to 35 days
> Value of 0 disabled automatic backup completely

> A DB outage if you change your retention period from zero to non zero value for the other way around from non zero to zero value
=======================================
##### DB SUBNET GROUP ###### v9

> Is a collection of subnet in a vpc that you want to allocated for DB instance launched in the vpc
> Is DB subnet group must have at least one subject in each easy in a reason
> Even if you are starting with standalone RDS instance configure the subnet group with the subnet in each easy in the reason
> This will facilitate launching your standby instance in the subnet group when you opt for multiple easy deployment
> during creating your RDS instance you can select a preferred easy and specify which subnet group and subnet group of TAT group for your RDS DB instance
> 10 audio service will allocate an IP address in that subnet to your RDS instance
> And then audio service will create and attached to the RDS instance and assign the above IP address to it
=======================================
### ENCRYPTION OF EXISTING UNENCRYPTED RDS INSTANCE v10
 
> You cannot encrypt an existing unencrypted DB instance

> To do that 
1. you need to create a new encrypted instance and migrate you data to it (from the unencrypted to the encrypted)
2. Restore from backup/snapshot into a new encrypted RDS instance

### App to DB instances encryption
> RDS supports SSL encryption for communication between the app instance and the RDS DB instance
- RDS generates a certificate for the instance which is used to encrypt this communication
- RDS service supports encryption at rest for all DB engine using AWS KMS

## RDS DB encryption at rest
> For an encrypted at rest DB instance
- All its snapshot
- Backup
- Data at storage(on the DB instance)
- Read replica related from the DB instance

- All are encrypted as well
- Encryption/decryption is handled transparently

## RDS DB instance security best practice
> Use AWS IAM account to control access to RDS API action
> Assign an individual IAM account to each person who manages RDS resources
> Grand the least permission required by each user to perform the assigned duties
> Use IAM groups to manage/grant permission to multiple user at a time
> Rotate your IAM credential regularly
=======================================
##### v11

RDS Billing – Standalone DB Instance
> No upfront costs

> You pay for:
DB instance hours (partial hours charged as full hours)
Storage GB/mo.
1/0 requests/mo. - for Magnetic RDS storage Instance only
Provisioned IOPS/mo. – For RDS Provisioned IOPS SSD instance
Sttery
Internet data transfer
Backup Storage (DB backups, and Active manual Snapshots)
This increases by increasing DB backups retention period
Backup storage for automated RDS backups (not the manual snapshots) up to the
Provisioned RDS instance's EBS volume size (EBS volume) is free of charge

## RDS Billing
> The DB storage provisioned to your DB instance is in a single AWS AZ
Since AWS backups your DB to multiple AZs for data durability
AWS charges for the database storage above the free allocated DB storage for-your
instance
Free automated backup storage provided to the client/account is in a single AZ

## RDS Billing – Multi-AZ deployments
AWS will charge for the following (in addition to the single AZ DB instance charges)
Multi-AZ DB hours
Provisioned Storage (Multi-AZ)
Double write I/0s (writing to the Active/Primary, and-Replication from Primary to
Standby)
16,000
during replication fröm primary to standby
You are not charged for DB data transfer
Your DB storage does not change between Standalone and Multi-AZ deployments
(same DB and same AWS Storage volume for that DB in multiple AZs for durability)

## RDS Billing – Standalone DB Instance
No upfront costs
You pay for:
DB instance hours (partial hours charged as full hours)
Storage GB/mo.
1/0 requests/mo. - for Magnetic RDS storage Instance only
Provisioned IOPS/mo. – For RDS Provisioned IOPS SSD instance
BOLHNG
Internet data transfer
Backup Storage (DB backups, and Active manual Snapshots)
• This increases by increasing DB backups retention period
• Backup storage for automated RDS backups (not the manual snapshots) up to the
Provisioned RDS instance's EBS volume size (EBS volume) is free of charge
[3:46 PM, 1/25/2020] Manish Agrawal: Free Tier
Single AZ:
750 Micro Instance Hours/month for each account for 1 year
For ORACLE you need to BYOL
[3:46 PM, 1/25/2020] Manish Agrawal: Reserved DB Instances (RIS)
Similar to EC2 Reserved Instances
DB RIs are "region" specific NOT AZ specific
One or three year term options
Each reservation must be specific in:
DOLFINed
DB Engine
DB Instance class
Multi-AZ option
License Model
Region
For RDS RI pricing to apply, an Exact RDS instance must be created on-demand, exact
on all above (DB Engine, Instance class, Multi AZ option, License model, and region)
[3:46 PM, 1/25/2020] Manish Agrawal: Reserved DB Instances (RIs)
You can NOT move RDS RIs between regions
You can move RDS RIs between AZs in the same region
You can NOT cancel an RDS RI's reservation
DOLFINed
=======================================
##### v12
======================================
##### v13
=======================================
##### v14
=======================================
########## AWS RDS SECURITY ########### 

> AWS provides multiple features to provide RDS security: 

1. DB instance can be hosted in a VPC for the greatest possible network access control
2. IAM policies can be used to assign permissions that determine who is allowed to manage RDS resources
3. Security groups allow to control what IP addresses or EC2 instances can connect to the databases on a DB instance
4. Secure Socket Layer (SSL) connections with DB instances
5. RDS encryption to secure RDS instances and snapshots at rest.
6. Network encryption and transparent data encryption (TDE) with Oracle DB instances


end